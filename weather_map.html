<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <title>Weather Map</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.3.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.3.0/mapbox-gl.css' rel='stylesheet' />


    <style>


        #box {
            display: flex;

        }

        ul {
            text-align: center;
            list-style: none;
        }


    </style>
</head>
<body>

<header>
    <h1>Weather Application</h1>
    <h2>City</h2>
</header>
<main>


        <div id="box"></div>


<!--    mapbox form -->
    <div>
        <h1>Enter Longitude and Latitude</h1>
        <form>
            <div class="form-group">
                <label for="latitude"></label>
                <input id="latitude" type="text" placeholder="Enter Latitude"><br>
                <label for="longitude"></label>
                <input id="longitude" type="text" placeholder="EnterLongitude">
                <button id="update-lat-long" type="button">Update</button>
            </div>
        </form>

    </div>


    <div id='map'></div>
    <pre id='coordinates' class='coordinates'></pre>



</main>



<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.4.1/mapbox-gl-geocoder.min.js'></script>
<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.4.1/mapbox-gl-geocoder.css' type='text/css' />



<script src="JS/jquery-2.2.4.js"></script>
<script src="JS/keys.js"></script>
<script>
    'use strict';

    // $.get("https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/" + darkSkyKey+ "/29.4241,-98.4936").done(function(data) {
    //     console.log(data);
    //
    //
    // });
    mapboxgl.accessToken = mapboxToken;

    var coordinates = document.getElementById('coordinates');

    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v9',
        zoom: 5,
        center: [-98.4916, 29.4252]
    });

    var lat = 29.424;
    var long = -98.4936;
    map.addControl(new MapboxGeocoder({
        accessToken: mapboxgl.accessToken,
        mapboxgl: mapboxgl
    }));


    var marker = new mapboxgl.Marker({
        draggable: true
    })
        .setLngLat([long, lat])
        .addTo(map);


    function onDragEnd() {
        var lngLat = marker.getLngLat();
        var i = lngLat.lng;
        var j = lngLat.lat;





    $.get("https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/" + darkSkyKey +  "/" + j + "," + i ).done(function(data) {

        // "/29.4241,-98.4936"

        var weatherHTML = "";


        for (var i = 0; i < 3; i++) {

                weatherHTML +=   "<ul>";
                weatherHTML +=   "<img src='" + changeImage(arrayOfIcons, data.daily.data[i].icon) +"'>";
                weatherHTML +=   "<li>" + data.daily.data[i].temperatureHigh + "° /" + data.daily.data[i].temperatureLow + "°</li>";
                weatherHTML +=   "<li>" + "HUMIDITY: " + data.daily.data[i].humidity  + "</li>";
                weatherHTML +=   "<li>" + "WIND SPEED: "+ data.daily.data[i].windSpeed  + "</li>";
                weatherHTML +=   "<li>" + "PRESSURE: " + data.daily.data[i].pressure  + "</li>";
                weatherHTML +=   "</ul>";


        }

        $('#box').html(weatherHTML);

    });
    }
    marker.on('dragend', onDragEnd);
    onDragEnd();

        //function to change icon


        function changeImage (arrayOfIcons, apiIcon) {
            for (var i = 0; i < arrayOfIcons.length; i++) {
                if (arrayOfIcons[i].status === apiIcon) {
                    return arrayOfIcons[i].image;
                }
            }
        }


    var arrayOfIcons = [
        {
            status: "clear-day",
            image: "icon/Sun.svg"
        },
        {
            status: "clear-night",
            image: "icon/Moon-Full.svg"
        }, {
            status: "rain",
            image: "icon/Cloud-Rain.svg"
        }, {
            status: "snow",
            image: "icon/Snowflake.svg"
        }, {
            status: "sleet",
            image: "icon/Cloud-Snow.svg"
        }, {
            status: "wind",
            image: "icon/Wind.svg"
        }, {
            status: "fog",
            image: "icon/Cloud-Fog.svg"
        }, {
            status: "cloudy",
            image: "icon/Cloud.svg"
        }, {
            status: "partly-cloudy-day",
            image: "icon/Cloud-Sun.svg"
        }, {
            status: "partly-cloudy-night",
            image: "icon/Cloud-Moon.svg"
        }
    ];





</script>


<!--MAPBOX-->


<script>

        // marker.on('dragend', onDragEnd);
        // onDragEnd();



    // var coor = {lng: -157.8060, lat: 21.2620};
    // reverseGeocode(coor, mapboxToken).then(function(result) {
    //     console.log(result)
    //
    // });

</script>
</body>
</html>